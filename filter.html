<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/styles.css">
  <title>Kaffekapslen</title>
</head>
<body>
<header><img src="images/header.jpg" alt=""></header>
<section class="container">


<label for=""><select class="" name=""><option disabled selected>Styrke</option></select></label>
<label for=""><select class="" name=""><option disabled selected>Størrelse</option></select></label>
<label for=""><select class="" name=""><option disabled selected>Kvalitet</option></select></label>
<label for=""><select class="" name=""><option disabled selected>Type</option></select></label>
<label for=""><select class="" name=""><option disabled selected>Sortering</option></select></label>
<div class="container__checkboxes">
<label><input name="organic" id="Organic" type="checkbox"/> Økologisk</label>
<label><input type="checkbox"/> Frugtig</label>
<label><input type="checkbox"/> Mørkristet</label>

<label><input type="checkbox"/> Aromatisk Arabica</label>
<label><input type="checkbox"/> Tilbehør</label>
<label><input type="checkbox"/> Lakrids</label>

<label><input type="checkbox"/> Koffeinfri</label>
<label><input type="checkbox"/> Karamel</label>
<label><input type="checkbox"/> The</label>

<!-- <input type="checkbox"> <label for="">Syrlighed</label> -->
</div>
<button type="button" id="search" class="container__checkboxes__submit">Søg</button>

<p id=demo></p>
<hr>
<p id="results"></p>
<table id="demo2"></table>

</section>
<script>

document.getElementById("search").addEventListener("click", loadXMLDoc);

function loadXMLDoc(){
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    resultcount(this);
    myFunction(this);
    }
};
xhttp.open("GET", "productFeedForNespresso.xml", true);
xhttp.send();
};


//      ||



function myFunction(xml) {
  let i;
  let xmlDoc = xml.responseXML;
  let table = "";
  let x = xmlDoc.getElementsByTagName("item");
  let sprice = xmlDoc.getElementsByTagName("specialPrice");
  // let cities = sprice.filter(val => {
  //   return val !== "undefined";
  // });

  // if (sprice.textContent !== "undefined"){
  // // var nodeList = sprice.textContent;
  // // var nodeArray = [];
  // // for ( i = 0; i < nodeList.length; ++i) {
  // //   nodeArray[i] = nodeList[i];
  // //   console.log(nodeArray);
//    var myNodeList = xmlDoc.getElementsByTagName("specialPrice");
// var myArrayFromNodeList = []; // empty at first
// for (i = 0; i < myNodeList.length; i++) {
//   myArrayFromNodeList.push(myNodeList[i]); // ahhh, push it
// }
// console.log(myNodeList); // NodeList
// console.log(myArrayFromNodeList); // Array of Nodes
//   var filtered = sprice.filter(function (el) {
//     sprice !=="undefined"
// });
// var data = [parseFloat(sprice[0].textContent).toFixed(2)];
// data = data.filter(function(element) {
//    return element !== undefined;
// });

// console.log(data);
// var newArray = x[i].getElementsByTagName('specialPrice').filter(function(item) {
//   return x[i].getElementsByTagName('specialPrice') !== "";
// });

var checkboxcounter = document.querySelectorAll('input[type="checkbox"]:checked').length;






// console.log(x[i].getElementsByTagName('specialPrice'));
    for (i = 0; i <x.length; i++) {
      let nodelist = x[i].getElementsByTagName('specialPrice');
      let priselist = x[i].getElementsByTagName("price");
      let strengthlist = x[i].getElementsByTagName("styrke");
      let egenskablist = x[i].getElementsByTagName("egenskaber");
      let sizelist = x[i].getElementsByTagName("cupsize");

    // let newArray =  Array.prototype.map.call( nodelist, function(n){
    // console.log(n.innerHTML);
    // });
    //



      let price = parseFloat(x[i].getElementsByTagName("price")[0].childNodes[0].nodeValue).toFixed(2);
      let title = x[i].getElementsByTagName("title")[0].childNodes[0].nodeValue;
      let a = x[i].getElementsByTagName("link")[0].childNodes[0].nodeValue;
      let img = x[i].getElementsByTagName("image_link")[0].childNodes[0].nodeValue;
      let sprice = x[i].getElementsByTagName("specialPrice");
      texts = Array.from(nodelist, node => node.textContent);
      newArray = Array.from(priselist, pris => pris.textContent);
      styrke = Array.from(strengthlist, strength => strength.textContent);
      egenskab = Array.from(egenskablist, egenskab => egenskab.textContent);
      cupsize = Array.from(sizelist, size => size.textContent);
      items = Array.from(x, item => item.childNodes);   //
      xlist = Array.from(x, items => x);
      espresso = cupsize.filter(cupsize => xlist == "Espresso" || xlist == "Ristretto,Espresso,Lungo" );
      organicFilter = xlist.filter(xlist => xlist == "Komposterbar,Økologisk");
      organiclist = x[i].innerHTML.includes("Komposterbar,Økologisk");

      console.log(items)
      // if(items[5].nodeList.textContent.includes("Komposterbar,Økologisk")){
      //   console.log(hej)
      // }
    // console.log(organicFilter[i].getElementsByTagName("title").textContent);

      if(typeof texts[i] === "undefined") {
          texts[i] = xmlDoc.getElementsByTagName("price")[i].childNodes[0].nodeValue;

   }
if(checkboxcounter == 9){
  table += "<article id='article"+i+"'>" + "<a href='"+a+"'>" +
    "<img class='image' src='"+img+"'>" + "<br/>" + "<h5>" + title + "</h5>" +
     "<p class='specialprice'>"+parseFloat(texts.sort()).toFixed(2) +"</p>"+ "<button class='readmore'>Læs mere</button>" +"</article>";
}

var organic = document.getElementById("Organic")
if(organic.checked){
  if(x[i].innerHTML.includes("Komposterbar,Økologisk")){

}
}



// document.getElementsByClassName("specialprice").innerHTML = price;

};

document.getElementById("demo2").innerHTML = table;







};



function resultcount(xml) {
    var xmlDoc = xml.responseXML;
    x = xmlDoc.getElementsByTagName('title').length;
    document.getElementById("results").innerHTML = "Results: " +
    x;
};











//
//        + "<button class='readmore'>Læs mere</button>" + "</a></article>";
//   }
//
//   document.getElementById("demo2").innerHTML = table;
//
// // document.getElementsByClassName("price").innerHTML = price;
// // document.getElementsByClassName("sprice").innerHTML = sprice;
// };

//   }
//   };






//   var nodes = xmlDoc.getElementsByTagName('title'), //Get the var nodes <node> tags
//     amountOfNodes = nodes.length
//
// for(var i = 0; i < amountOfNodes; i++) { //loop thru the nodes
//
//   console.log(nodes[i].getElementsByTagName('title').length); //get the amount of <alarm> tags
//   document.getElementById("results").innerHTML = txt;
// };
// function my(xml) {
//     var x, i, txt, xmlDoc;
//     xmlDoc = xml.responseXML;
//     txt = "";
//     x = xmlDoc.getElementsByTagName("description");
//     for (i = 0; i < x.length; i++) {
//         txt += x[i].childNodes[0].nodeValue + "<br>";
//     }
//     document.getElementById("description").innerHTML = txt;
// }


    // x = xmlDoc.getElementsByTagName('title');
    // xLen = x.length;
    //
    // for (i = 0; i <xLen; i++) {
    //     txt += x[i].childNodes[0].nodeValue) + " ";
    // }

// function myFunction(xml) {
    // var x, i, xmlDoc, txt;
    // xmlDoc = xml.responseXML;
    // txt = "";
    // x = xmlDoc.getElementsByTagName('title');
    // for (i = 0 ; i <x.length; i++) {
    //     txt += x[i].childNodes[0].nodeValue + "<br>";
    // }
    // document.getElementById("demo").innerHTML = txt;

</script>

</body>
</html>
